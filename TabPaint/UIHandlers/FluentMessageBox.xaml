<Window x:Class="TabPaint.FluentMessageBox"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="TabPaint Message" 
        Height="Auto" Width="420"
        WindowStyle="None"
        ResizeMode="NoResize"
        SizeToContent="Height"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False">
    <Window.Resources>
        <ResourceDictionary>
            <!-- 引入子窗口样式 (保持原样) -->
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Resources/SubWindowStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" ResizeBorderThickness="5" GlassFrameThickness="-1"/>
    </WindowChrome.WindowChrome>

    <!-- 主容器：带有阴影和边框 -->
    <Border Background="{DynamicResource ControlBackgroundBrush}" 
            BorderBrush="{DynamicResource BorderBrush}" 
            BorderThickness="1" 
            CornerRadius="8"
            Margin="10">
        <Border.Effect>
            <!-- 阴影效果 -->
            <DropShadowEffect BlurRadius="20" ShadowDepth="5" Direction="270" Color="Black" Opacity="0.25"/>
        </Border.Effect>

        <!-- 使用 Grid 将标题栏和内容区分开 -->
        <!-- ClipToBounds=True 确保内部背景色不会溢出圆角 -->
        <Grid ClipToBounds="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- 0: 标题栏 -->
                <RowDefinition Height="*"/>
                <!-- 1: 内容区 -->
                <RowDefinition Height="Auto"/>
                <!-- 2: 按钮区 -->
            </Grid.RowDefinitions>

            <!-- 设置外层Border的圆角遮罩，防止内部矩形背景覆盖圆角 -->
            <Grid.OpacityMask>
                <VisualBrush>
                    <VisualBrush.Visual>
                        <Border Background="Black" Width="{Binding ActualWidth, RelativeSource={RelativeSource FindAncestor, AncestorType=Grid}}" Height="{Binding ActualHeight, RelativeSource={RelativeSource FindAncestor, AncestorType=Grid}}" CornerRadius="7"/>
                    </VisualBrush.Visual>
                </VisualBrush>
            </Grid.OpacityMask>

            <!-- ================= 标题栏 ================= -->
            <!-- 稍微深一点的颜色作为底色区分 (SubtleHoverBrush 通常比背景深一点点) -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource SubtleHoverBrush}" 
                    Height="32"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 标题文字 -->
                    <TextBlock x:Name="TxtTitle" 
                               Text="Title" 
                               VerticalAlignment="Center" 
                               Margin="24,0,0,0"
                               FontWeight="SemiBold" 
                               FontSize="12" 
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               IsHitTestVisible="False"/>
                    <!-- 穿透点击以支持拖拽 -->

                    <!-- 关闭按钮 (右上角) -->
                    <Button Grid.Column="1"
                            Style="{StaticResource WindowCloseButtonStyle}"
                            Click="BtnClose_Click"
                            WindowChrome.IsHitTestVisibleInChrome="True"/>
                </Grid>
            </Border>

            <!-- 分割线 (可选，如果颜色区分明显可不要) -->
            <Border Grid.Row="0" VerticalAlignment="Bottom" Height="1" Background="{DynamicResource BorderBrush}" Opacity="0.5"/>

            <!-- ================= 内容区 ================= -->
            <Grid Grid.Row="1" Margin="24,20,24,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 可选：图标区域 (如果需要显示 Info/Warning 图标，可加在这里) -->
                <!-- <Path ... Grid.Column="0" /> -->

                <TextBlock x:Name="TxtMessage" 
                           Grid.Column="1"
                           Text="Message Content" 
                           TextWrapping="Wrap" 
                           FontSize="14" 
                           LineHeight="20"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
            </Grid>

            <!-- ================= 按钮区 ================= -->
            <Border Grid.Row="2" 
                    Background="{DynamicResource ControlAltBackgroundBrush}" 
                    Padding="24,16,24,24">
                <!-- ControlAltBackgroundBrush 可以设置成与标题栏一样的浅灰色，形成上下呼应，或者就用透明 -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">

                    <Button x:Name="BtnYes" Content="Yes" Style="{DynamicResource Win11PrimaryButtonStyle}" Width="76" Height="32" Margin="8,0,0,0" Click="BtnYes_Click" Visibility="Collapsed"/>
                    <Button x:Name="BtnOk" Content="OK" Style="{DynamicResource Win11PrimaryButtonStyle}" Width="76" Height="32" Margin="8,0,0,0" Click="BtnOk_Click" Visibility="Collapsed"/>

                    <Button x:Name="BtnNo" Content="No" Style="{DynamicResource Win11SecondaryButtonStyle}" Width="76" Height="32" Margin="8,0,0,0" Click="BtnNo_Click" Visibility="Collapsed"/>
                    <Button x:Name="BtnCancel" Content="Cancel" Style="{DynamicResource Win11SecondaryButtonStyle}" Width="76" Height="32" Margin="8,0,0,0" Click="BtnCancel_Click" Visibility="Collapsed"/>

                </StackPanel>
            </Border>

        </Grid>
    </Border>
</Window>

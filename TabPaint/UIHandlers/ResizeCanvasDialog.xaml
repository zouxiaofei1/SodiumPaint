<Window x:Class="TabPaint.ResizeCanvasDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="{DynamicResource L_ResizeCanvas_Title}" 
        Height="340" Width="400"
        MinHeight="200" MinWidth="200"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize" 
        ShowInTaskbar="False"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="Transparent"
        FontFamily="Segoe UI Variable, Segoe UI, Microsoft YaHei UI"
        Loaded="Window_Loaded">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" CornerRadius="8" GlassFrameThickness="-1"/>
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Resources/SubWindowStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- 覆盖 Slider 轨道高度和 Thumb，使其更符合现代风格 -->
            <Style x:Key="ModernSliderStyle" TargetType="Slider" BasedOn="{StaticResource Win11HorizontalSliderStyle}">
                <Setter Property="Margin" Value="0,8"/>
            </Style>

            <!-- 覆盖本地 TextBox 样式为 SubWindowStyles 中的样式 -->
            <Style TargetType="TextBox" BasedOn="{StaticResource ModernTextBoxStyle}">
                <Setter Property="Height" Value="32"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="TextAlignment" Value="Left"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <!-- 主容器 -->
    <Border Background="Transparent" 
            CornerRadius="12" 
            BorderBrush="{DynamicResource BorderLightBrush}" 
            BorderThickness="1" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" BorderThickness="0,0,0,1" Background="Transparent">
                <Grid >
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Image Grid.Column="0" Source="pack://application:,,,/Resources/TabPaint.ico" 
                           Width="20" Height="20" Margin="12,0,8,0" 
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <TextBlock Grid.Column="1" Text="{DynamicResource L_ResizeCanvas_Title}" 
                               VerticalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Top">

                        <Button Width="48" Height="30" ToolTip="{DynamicResource L_TitleBar_Close}" Click="OnCloseClick" Style="{StaticResource WindowCloseButtonStyle}">
                            <Viewbox Width="10" Height="10">
                                <Path Stroke="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                              StrokeThickness="1" 
                              Data="M0,0 L12,12 M12,0 L0,12"/>
                            </Viewbox>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            <!-- 2. 模式选择 (移除卡片外框) -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="24,20,24,12" >
            
                <TextBlock Text="{DynamicResource L_ResizeCanvas_Mode}" 
                           Style="{StaticResource LabelStyle}"
                           Margin="0,0,16,0"/>
                <ComboBox Style="{StaticResource FluentComboBoxStyle}" 
                          x:Name="ModeComboBox" 
                          Width="180" 
                          SelectedIndex="0" 
                          SelectionChanged="ModeComboBox_SelectionChanged">
                    <ComboBoxItem Content="{DynamicResource L_ResizeCanvas_Mode_Resample}"/>
                    <ComboBoxItem Content="{DynamicResource L_ResizeCanvas_Mode_Canvas}"/>
                </ComboBox>
            </StackPanel>

            <!-- 3. 控制区域 -->
            <Grid Grid.Row="2" Margin="24,0,24,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="90"/>
                    <ColumnDefinition Width="25"/>
                </Grid.ColumnDefinitions>

                <!-- 宽度 -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource L_ResizeCanvas_Width}" Style="{StaticResource LabelStyle}"/>
                <Slider x:Name="WidthSlider" Grid.Row="0" Grid.Column="1" 
                        Style="{StaticResource ModernSliderStyle}"
                        Minimum="-1" Maximum="1" Value="0" LargeChange="0.1"
                        ValueChanged="WidthSlider_ValueChanged"/>
                <TextBox x:Name="WidthTextBox" Grid.Row="0" Grid.Column="3" TextChanged="WidthTextBox_TextChanged" PreviewTextInput="NumberValidationTextBox"/>
                <TextBlock Grid.Row="0" Grid.Column="4" Text="px" VerticalAlignment="Center" HorizontalAlignment="Right" Foreground="{DynamicResource TextTertiaryBrush}" FontSize="12"/>

                <!-- 锁链按钮 (交互优化) -->
                <ToggleButton x:Name="AspectRatioToggle" Grid.Row="1" Grid.Column="3" 
                              HorizontalAlignment="Center" Margin="0,0"
                              Style="{StaticResource AnimatedLinkToggleStyle}" IsChecked="True"
                              ToolTip="{DynamicResource L_ResizeCanvas_KeepAspectRatio}" Click="AspectRatioToggle_Click"/>

                <!-- 高度 -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource L_ResizeCanvas_Height}" Style="{StaticResource LabelStyle}"/>
                <Slider x:Name="HeightSlider" Grid.Row="2" Grid.Column="1" 
                        Style="{StaticResource ModernSliderStyle}"
                        Minimum="-1" Maximum="1" Value="0" LargeChange="0.1"
                        ValueChanged="HeightSlider_ValueChanged"/>
                <TextBox x:Name="HeightTextBox" Grid.Row="2" Grid.Column="3" TextChanged="HeightTextBox_TextChanged" PreviewTextInput="NumberValidationTextBox"/>
                <TextBlock Grid.Row="2" Grid.Column="4" Text="px" VerticalAlignment="Center" HorizontalAlignment="Right" Foreground="{DynamicResource TextTertiaryBrush}" FontSize="12"/>

                <!-- 信息提示卡片 -->
                <Border Grid.Row="3" Grid.ColumnSpan="5" Margin="0,8,0,0" 
                        Background="Transparent" CornerRadius="6" Padding="12,8">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" 
                              Fill="{DynamicResource TextTertiaryBrush}" Width="14" Height="14" Stretch="Uniform" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <TextBlock x:Name="InfoTextBlock" FontSize="12" 
                                   Foreground="{DynamicResource TextTertiaryBrush}" TextWrapping="Wrap"
                                   Text="{DynamicResource L_ResizeCanvas_OriginSize}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border> 
            </Grid>

            <!-- 4. 底部按钮 (添加背景和分割线) -->
            <Border Grid.Row="3" 
                    Background="{DynamicResource ChromeLowBrush}" 
                    CornerRadius="0,0,11,11"
                    BorderBrush="{DynamicResource BorderLightBrush}"
                    BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <CheckBox x:Name="ApplyToAllCheckBox" 
                              Grid.Column="0" 
                              Content="{DynamicResource L_ResizeCanvas_ApplyToAll}" 
                              Margin="24,0,0,0"  
                              Style="{StaticResource FluentCheckBoxStyle}"
                              VerticalAlignment="Center" FontSize="12">
                    </CheckBox>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="24,16">
                        <Button x:Name="OkButton" Content="{DynamicResource L_Common_OK}" 
                                Width="84" Height="32" IsDefault="True" Click="OkButton_Click" 
                                Style="{StaticResource Win11PrimaryButtonStyle}"/>
                        <Button x:Name="CancelButton" Content="{DynamicResource L_Common_Cancel}" 
                                Width="84" Height="32" Margin="12,0,0,0" IsCancel="True" 
                                Style="{StaticResource Win11SecondaryButtonStyle}" Click="CancelButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>

<Window x:Class="TabPaint.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TabPaint"
        xmlns:pages="clr-namespace:TabPaint.Pages" 
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=presentationframework"
        mc:Ignorable="d"
        
        Title="{DynamicResource L_Settings_Title}" Height="500" Width="520"
        MinHeight="350" MinWidth="520"
        WindowStyle="None" ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner"
        Background="Transparent"
        Foreground="{DynamicResource TextPrimaryBrush}">

    <WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="40" 
                            GlassFrameThickness="-1" 
                            CornerRadius="0" 
                            ResizeBorderThickness="4"
                            UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Resources/SubWindowStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <local:NonLinearConverter x:Key="NonLinearConverter"/>
            <local:ColorMatchConverter x:Key="ColorMatchConverter"/>

            <!-- 汉堡菜单按钮样式 -->
            <Style x:Key="HamburgerButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="LayoutRoot" Background="{TemplateBinding Background}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="LayoutRoot" Property="Background" Value="#1FFFFFFF"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 导航项样式 -->
            <Style x:Key="NavListBoxItemStyle" TargetType="ListBoxItem">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Margin" Value="4,2"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Border x:Name="LayoutRoot" CornerRadius="4" 
                                    Background="{TemplateBinding Background}"
                                    SnapsToDevicePixels="True">
                                <Grid>
                                    <Border x:Name="SelectionIndicator" Width="3" Height="16" 
                                            HorizontalAlignment="Left" VerticalAlignment="Center"
                                            Background="{DynamicResource ThemeAccentBrush}"
                                            CornerRadius="1.5" Visibility="Collapsed" Margin="0,0,0,0"/>
                                    <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="LayoutRoot" Property="Background" Value="{DynamicResource SubtleHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="LayoutRoot" Property="Background" Value="{DynamicResource SubtleSelectedBrush}"/>
                                    <Setter TargetName="SelectionIndicator" Property="Visibility" Value="Visible"/>
                                </Trigger>
                                <Trigger Property="IsMouseCaptured" Value="True">
                                    <Setter TargetName="LayoutRoot" Property="Background" Value="{DynamicResource SubtlePressedBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 窗口控制按钮样式 -->
            <Style x:Key="TitleBarButtonStyle" TargetType="Button">
                <Setter Property="Width" Value="46"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Border" Background="{TemplateBinding Background}">
                                <TextBlock Text="{TemplateBinding Content}" FontFamily="Segoe MDL2 Assets" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="{DynamicResource SubtleHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="{DynamicResource SubtlePressedBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="TitleBarCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="Border" Background="{TemplateBinding Background}">
                                <TextBlock Text="{TemplateBinding Content}" FontFamily="Segoe MDL2 Assets" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#C42B1C"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#A82417"/>
                                    <Setter Property="Foreground" Value="#E6E6E6"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 标题栏 -->
            <RowDefinition Height="*"/>
            <!-- 内容 -->
        </Grid.RowDefinitions>

        <!-- 1. 自定义标题栏 -->
        <Grid Grid.Row="0" Background="{DynamicResource GlassBackgroundMediumBrush}" Height="32">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" Grid.Column="0" VerticalAlignment="Center" Margin="0">
                <TextBlock Text="{DynamicResource L_Settings_Title}" 
                           VerticalAlignment="Center" Margin="18,0,0,0" 
                           FontSize="12" Foreground="{DynamicResource TextPrimaryBrush}"/>
            </StackPanel>

            <!-- 右侧：窗口控制按钮 -->
            <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Right">
                <Button x:Name="BtnMinimize" Style="{StaticResource TitleBarButtonStyle}" Content="&#xE921;" Click="BtnMinimize_Click"/>
                <Button x:Name="BtnMaximize" Style="{StaticResource TitleBarButtonStyle}" Content="&#xE922;" Click="BtnMaximize_Click"/>
                <Button x:Name="BtnClose" Style="{StaticResource TitleBarCloseButtonStyle}" Content="&#xE8BB;" Click="BtnClose_Click"/>
            </StackPanel>
        </Grid>

        <!-- 2. 主体区域 -->
        <Grid Grid.Row="1" Background="Transparent">
            <Grid.ColumnDefinitions>
                <!-- 侧边栏宽度，支持动画 -->
                <ColumnDefinition Width="Auto" x:Name="NavColumn"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧导航栏 -->
            <Border Grid.Column="0" x:Name="SidebarBorder" Width="220"  Background="{DynamicResource GlassBackgroundLowBrush}" 
                    BorderBrush="{DynamicResource BorderBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- 汉堡菜单 -->
                        <RowDefinition Height="*"/>
                        <!-- 上部列表 -->
                        <RowDefinition Height="Auto"/>
                        <!-- 底部列表 -->
                    </Grid.RowDefinitions>

                    <!-- 汉堡菜单按钮 -->
                    <Button Grid.Row="0" Click="HamburgerBtn_Click" 
                            HorizontalAlignment="Left" Margin="0,0,0,4"
                            Style="{StaticResource HamburgerButtonStyle}" 
                            Width="46" Height="36">
                        <Path Data="M3,6 L17,6 M3,11 L17,11 M3,16 L17,16" 
                              Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                              StrokeThickness="1" 
                              Stretch="None" 
                              VerticalAlignment="Center" 
                              HorizontalAlignment="Center"/>
                    </Button>

                    <ListBox x:Name="NavListBox" Grid.Row="1"
                             SelectionChanged="NavListBox_SelectionChanged"      
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Disabled"
                             Background="Transparent" BorderThickness="0" Margin="0,5,0,0"
                             ItemContainerStyle="{StaticResource NavListBoxItemStyle}">

                        <ListBoxItem Tag="General" IsSelected="True">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Grid.Column="0" Data="{DynamicResource Settings_General_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" x:Name="TxtGeneral" Text="{DynamicResource L_Settings_Nav_General}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}" Margin="8,0,0,0" FontSize="12"/>
                            </Grid>
                        </ListBoxItem>

                        <ListBoxItem Tag="Paint">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource Paint_Mode_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Foreground="{DynamicResource TextPrimaryBrush}" Margin="8,0,0,0" Text="{DynamicResource L_Settings_Nav_Paint}" VerticalAlignment="Center" x:Name="TxtPaint"/>
                            </Grid>
                        </ListBoxItem>

                        <ListBoxItem Tag="View">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource View_Mode_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Margin="8,0,0,0" Foreground="{DynamicResource TextPrimaryBrush}" Text="{DynamicResource L_Settings_Nav_View}" VerticalAlignment="Center" x:Name="TxtView"/>
                            </Grid>
                        </ListBoxItem>

                        <ListBoxItem Tag="Shortcuts">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource Keyboard_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Margin="8,0,0,0" Foreground="{DynamicResource TextPrimaryBrush}" Text="{DynamicResource L_Settings_Nav_Shortcuts}" VerticalAlignment="Center" x:Name="TxtShortcuts"/>
                            </Grid>
                        </ListBoxItem>

                        <ListBoxItem Tag="Advanced">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource Settings_Advanced_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Margin="8,0,0,0" Foreground="{DynamicResource TextPrimaryBrush}" Text="{DynamicResource L_Settings_Nav_Advanced}" VerticalAlignment="Center" x:Name="TxtAdvanced"/>
                            </Grid>
                        </ListBoxItem>
                        <ListBoxItem Tag="Plugins" Visibility="Collapsed">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource View_Mode_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Margin="8,0,0,0" Foreground="{DynamicResource TextPrimaryBrush}" Text="{DynamicResource L_Settings_Nav_Plugins}" VerticalAlignment="Center" x:Name="TxtPlugins"/>
                            </Grid>
                        </ListBoxItem>
                    </ListBox>

                    <ListBox x:Name="BottomListBox" Grid.Row="2"
                             SelectionChanged="NavListBox_SelectionChanged"
                             Background="Transparent" BorderThickness="0" Margin="0,0,0,10"
                             ItemContainerStyle="{StaticResource NavListBoxItemStyle}" 
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Disabled">
                        <ListBoxItem Tag="About">
                            <Grid Width="212" Height="40">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Path Data="{DynamicResource Info_Image}" Stretch="Uniform" Fill="{DynamicResource IconFillBrush}" Width="16" Height="16"/>
                                <TextBlock Grid.Column="1" Margin="8,0,0,0" Foreground="{DynamicResource TextPrimaryBrush}" Text="{DynamicResource L_Settings_Nav_About}" VerticalAlignment="Center" x:Name="TxtAbout"/>
                            </Grid>
                        </ListBoxItem>
                    </ListBox>
                </Grid>
            </Border>

            <!-- 右侧内容区 -->
            <Border Grid.Column="1" Background="Transparent" ClipToBounds="True">
                <Grid>
                    <!-- 主内容滚动区 -->
                    <ScrollViewer Style="{StaticResource FluentScrollViewer}" Padding="0" Margin="0" 
                                  VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" PanningMode="None">

                        <!-- 核心修改：使用 ContentControl 动态加载 UserControl -->
                        <ContentControl x:Name="MainContent" Margin="0"/>

                    </ScrollViewer>

                    <!-- Toast 通知区域 -->
                    <StackPanel VerticalAlignment="Top" HorizontalAlignment="Right" 
                                Margin="0,10,20,0" Panel.ZIndex="999">

                        <!-- 1. 更新通知 -->
                        <Border x:Name="UpdateToast"
                                Background="{DynamicResource ThemeAccentBrush}"
                                Padding="16,10" CornerRadius="4"
                                Visibility="Collapsed" Opacity="0"
                                Cursor="Hand" MouseLeftButtonUp="UpdateToast_Click"
                                Margin="0,0,0,10">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                            </Border.Effect>
                            <Border.RenderTransform>
                                <TranslateTransform X="50"/>
                            </Border.RenderTransform>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE896;" FontFamily="Segoe MDL2 Assets" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,10,0" VerticalAlignment="Center" FontSize="16"/>
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource L_Update_Found_Title}" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" FontSize="12"/>
                                    <TextBlock x:Name="TxtUpdateVer" Text="New version available" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="11"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- 2. 保存成功通知 -->
                        <Border x:Name="SavedToast" 
                                Background="{DynamicResource ThemeAccentBrush}" 
                                Padding="16,10" CornerRadius="4"
                                Visibility="Collapsed" Opacity="0" 
                                IsHitTestVisible="False">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                            </Border.Effect>
                            <Border.RenderTransform>
                                <TranslateTransform X="50"/>
                            </Border.RenderTransform>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE73E;" FontFamily="Segoe MDL2 Assets" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{DynamicResource L_Settings_Toast_Saved}" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <!-- 3. 冲突通知 -->
                        <Border x:Name="ConflictToast" 
                                Background="{DynamicResource DangerBrush}" 
                                Padding="16,10" CornerRadius="4"
                                Visibility="Collapsed" Opacity="0" 
                                IsHitTestVisible="False">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                            </Border.Effect>
                            <Border.RenderTransform>
                                <TranslateTransform X="50"/>
                            </Border.RenderTransform>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE7BA;" FontFamily="Segoe MDL2 Assets" Foreground="White" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <TextBlock x:Name="TxtConflict" Text="Conflict" Foreground="White" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>

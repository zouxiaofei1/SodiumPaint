<Window x:Class="TabPaint.ModernColorPickerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="编辑颜色" Height="660" Width="720"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" CornerRadius="8" GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <DrawingBrush x:Key="CheckerboardBrush" TileMode="Tile" Viewport="0,0,10,10" ViewportUnits="Absolute">
            <DrawingBrush.Drawing>
                <DrawingGroup>
                    <GeometryDrawing Brush="White">
                        <GeometryDrawing.Geometry>
                            <RectangleGeometry Rect="0,0,10,10"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                    <GeometryDrawing Brush="#CCC">
                        <GeometryDrawing.Geometry>
                            <GeometryGroup>
                                <RectangleGeometry Rect="0,0,5,5"/>
                                <RectangleGeometry Rect="5,5,5,5"/>
                            </GeometryGroup>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingBrush.Drawing>
        </DrawingBrush>
        <SolidColorBrush x:Key="WindowBackground" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="HeaderBackground" Color="#F3F3F3"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#333333"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#666666"/>
        <SolidColorBrush x:Key="ControlBorder" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="AccentColor" Color="#0078D7"/>
        <SolidColorBrush x:Key="AccentHover" Color="#1084E3"/>
        <Style x:Key="MiniColorSwatch" TargetType="Button">
            <Setter Property="Cursor" Value="Hand"/>
            <!-- 去掉Margin，完全填充父容器 -->
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Ellipse Width="24" Height="24" Fill="{StaticResource CheckerboardBrush}"/>

                            <Ellipse x:Name="ColorCircle" 
                             Fill="{TemplateBinding Background}" 
                             Stroke="#E0E0E0" 
                             StrokeThickness="1"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <!-- 鼠标悬停变暗或改变边框 -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="ColorCircle" Property="Stroke" Value="#999"/>
                                <Setter TargetName="ColorCircle" Property="StrokeThickness" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- 文本框样式 (浅色) -->
        <Style x:Key="FluentTextBox" TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource ControlBorder}"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="#999"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource AccentColor}"/>
                                <Setter Property="BorderThickness" TargetName="border" Value="2"/>
                                </Trigger>
           
            </ControlTemplate.Triggers>
            </ControlTemplate>
            </Setter.Value>
            </Setter>
        </Style>

        <!-- 普通按钮样式 (浅色) -->
        <Style x:Key="FluentButton" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="15,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" TargetName="border" Value="#E0E0E0"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" TargetName="border" Value="#D0D0D0"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" CenterX="50" CenterY="15"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 强调色按钮 (蓝色) -->
        <Style x:Key="FluentAccentButton" TargetType="{x:Type Button}" BasedOn="{StaticResource FluentButton}">
            <Setter Property="Background" Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" TargetName="border" Value="{StaticResource AccentHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" TargetName="border" Value="#005A9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <ControlTemplate x:Key="FluentComboBoxToggleButton" TargetType="ToggleButton">
            <Border x:Name="Border" 
          CornerRadius="6" 
          BorderBrush="{TemplateBinding BorderBrush}" 
          BorderThickness="{TemplateBinding BorderThickness}" 
          Background="{TemplateBinding Background}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="24"/>
                    </Grid.ColumnDefinitions>
                    <!-- 下拉小箭头 -->
                    <Path x:Name="Arrow" Grid.Column="1" Fill="#666" 
                HorizontalAlignment="Center" VerticalAlignment="Center" 
                Data="M0,0 L3.5,3.5 L7,0" Stroke="#666" StrokeThickness="1"/>
                </Grid>
            </Border>
            <ControlTemplate.Triggers>
                <!-- 悬停效果：仅改变背景色，边框稍微加深 -->
                <Trigger Property="IsMouseOver" Value="true">
                    <Setter TargetName="Border" Property="Background" Value="#F9F9F9"/>
                    <Setter TargetName="Border" Property="BorderBrush" Value="#BDBDBD"/>
                </Trigger>
                <!-- 展开时的效果 -->
                <Trigger Property="IsChecked" Value="true">
                    <Setter TargetName="Border" Property="Background" Value="#FFFFFF"/>
                    <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        <!-- 2. Fluent 风格 ComboBox -->
        <ControlTemplate x:Key="FluentComboBoxTemplate" TargetType="ComboBox">
            <Grid>
                <!-- 背景层 -->
                <ToggleButton Name="ToggleButton" 
                    Template="{StaticResource FluentComboBoxToggleButton}" 
                    Focusable="false" 
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    Background="{TemplateBinding Background}"
                    IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}" 
                    ClickMode="Press"/>

                <!-- 内容显示区域 (非编辑状态) -->
                <ContentPresenter Name="ContentSite" IsHitTestVisible="False" 
                        Content="{TemplateBinding SelectionBoxItem}"
                        ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                        ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                        Margin="10,0,24,0" VerticalAlignment="Center" HorizontalAlignment="Left" />

                <!-- 关键修复：编辑框 (去掉默认边框、背景、阴影) -->
                <TextBox x:Name="PART_EditableTextBox" 
               Style="{x:Null}" 
               BorderThickness="0" 
               Background="Transparent" 
               Padding="0"
               Margin="10,0,24,0"
               VerticalAlignment="Center" 
               VerticalContentAlignment="Center"
               Focusable="True" 
               HorizontalAlignment="Stretch"
               CaretBrush="Black"/>

                <!-- 下拉弹窗 -->
                <Popup Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                    <Grid Name="DropDown" SnapsToDevicePixels="True" MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                        <Border x:Name="DropDownBorder" Background="White" BorderThickness="1" BorderBrush="#E0E0E0" CornerRadius="6" Margin="0,4,0,4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.1" Direction="270"/>
                            </Border.Effect>
                            <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Popup>
            </Grid>
            <ControlTemplate.Triggers>
                <!-- 当 ComboBox 不可编辑时，隐藏 TextBox -->
                <Trigger Property="IsEditable" Value="false">
                    <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Collapsed"/>
                    <Setter TargetName="ContentSite" Property="Visibility" Value="Visible"/>
                </Trigger>
                <!-- 当 ComboBox 可编辑时，显示 TextBox，隐藏 ContentPresenter -->
                <Trigger Property="IsEditable" Value="true">
                    <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                    <Setter TargetName="ContentSite" Property="Visibility" Value="Collapsed"/>
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <Style x:Key="FluentComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template" Value="{StaticResource FluentComboBoxTemplate}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DCDCDC"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <!-- 移除焦点虚线 -->
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        </Style>
        <!-- 颜色块样式 -->
        <Style x:Key="ColorSwatch" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <!-- 选中/悬停时的外圈 -->
                            <Ellipse x:Name="Border" Stroke="Transparent" StrokeThickness="2" Width="32" Height="32"/>
                            <!-- 颜色本体 -->
                            <Ellipse x:Name="ColorCircle" Width="24" Height="24" Fill="{TemplateBinding Background}" Stroke="#E5E5E5" StrokeThickness="1"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Stroke" Value="#B0B0B0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- 主窗口背景 -->
    <Border Background="{StaticResource WindowBackground}" CornerRadius="8" BorderBrush="#CCC" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.15" Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="64"/>
                <!-- Header -->
                <RowDefinition Height="Auto"/>
                <!-- Main Picker -->
                <RowDefinition Height="*"/>
                <!-- Swatches -->
                <RowDefinition Height="Auto"/>
                <!-- Footer -->
            </Grid.RowDefinitions>

            <!-- 1. Header (浅灰色背景) -->
            <Border Grid.Row="0" Background="{StaticResource HeaderBackground}" CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseDown" Margin="0,0,0,20">
                <Grid Margin="10,4,14,4">
                    <Image  HorizontalAlignment="Left"  x:Name="AppIcon" 
       Grid.Column="0"
       Source="pack://application:,,,/Resources/TabPaint.ico" 
       Width="24" Height="24" 
       Margin="4,0,12,0"
       VerticalAlignment="Center"
       RenderOptions.BitmapScalingMode="HighQuality"/>
                    <TextBlock Padding="36,0,0,0" Text="编辑颜色" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                    <Button HorizontalAlignment="Right" Content="✕" Width="32" Height="32"
                           Style="{StaticResource FluentButton}" Background="Transparent" BorderThickness="0" Foreground="#888"
                            Click="CancelButton_Click"/>
                </Grid>
            </Border>

            <!-- 2. Main Picker Area -->
            <Grid Grid.Row="1" Height="330" Margin="24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="280"/>
                    <ColumnDefinition Width="45"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Color Map -->
                <Grid Grid.Column="0" ClipToBounds="False" Cursor="Cross"
                      MouseLeftButtonDown="Spectrum_MouseDown"
                      MouseMove="Spectrum_MouseMove"
                      MouseLeftButtonUp="Spectrum_MouseUp">
                    <Rectangle Fill="{StaticResource CheckerboardBrush}" RadiusX="4" RadiusY="4"/>
                    <Grid x:Name="SpectrumLayerGroup">
                        <Rectangle x:Name="SpectrumBaseColor" Fill="Red" RadiusX="4" RadiusY="4"/>
                    <Rectangle RadiusX="4" RadiusY="4">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="White" Offset="0"/>
                                <GradientStop Color="#00FFFFFF" Offset="1"/>
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                    </Rectangle>
                    <Rectangle RadiusX="4" RadiusY="4">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                                <GradientStop Color="Black" Offset="0"/>
                                <GradientStop Color="#00000000" Offset="1"/>
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                    </Rectangle>
                    </Grid>
                    <Canvas x:Name="CursorCanvas" IsHitTestVisible="False">
                        <Ellipse x:Name="ColorCursor" Width="16" Height="16" Stroke="White" StrokeThickness="2" Margin="-8,-8,0,0">
                            <Ellipse.Effect>
                                <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="Black" Opacity="0.5"/>
                            </Ellipse.Effect>
                        </Ellipse>
                    </Canvas>
                </Grid>

                <!-- Hue Slider -->
                <Grid Grid.Column="1" Margin="0,0" Background="Transparent"
      MouseLeftButtonDown="Hue_MouseDown"
      MouseMove="Hue_MouseMove"
      MouseLeftButtonUp="Hue_MouseUp"
      Cursor="Hand" x:Name="HueSliderGrid">
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" 
               HorizontalAlignment="Center" IsHitTestVisible="False">
                        <Rectangle.Fill>
                            <!-- 关键点：使用 ImageBrush 绑定到下面隐藏的 Image 控件 -->
                            <ImageBrush ImageSource="{Binding Source, ElementName=HueSliderImage}"/>
                        </Rectangle.Fill>
                    </Rectangle>

                    <!-- 2. 原有的 Image 控件：隐藏它，但保留它以兼容后台代码 -->
                    <Image x:Name="HueSliderImage" Visibility="Collapsed" Stretch="Fill" />
                    <!-- Hue Slider 部分 -->
                    <Canvas x:Name="HueCursorCanvas" Width="28" HorizontalAlignment="Center" VerticalAlignment="Stretch">
                        <!-- 【修改点】Margin 改为 "0,-14,0,0" -->
                        <Grid x:Name="HueCursor" Width="28" Height="28" Margin="0,-14,0,0"  MouseLeftButtonDown="Hue_Thumb_MouseDown">
                            <Ellipse Width="28" Height="28"  Fill="White" Stroke="#F0F0F0" StrokeThickness="4">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="6" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                                </Ellipse.Effect>
                            </Ellipse>
                        </Grid>
                    </Canvas>

                </Grid>
                <Grid Grid.Column="2" Margin="10,0,0,0" Background="Transparent"
                      MouseLeftButtonDown="Alpha_MouseDown"
                      MouseMove="Alpha_MouseMove"
                      MouseLeftButtonUp="Alpha_MouseUp"
                      Cursor="Hand" x:Name="AlphaSliderGrid">

                    <!-- 背景：灰白格子 -->
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" 
                               HorizontalAlignment="Center" Fill="{StaticResource CheckerboardBrush}"/>

                    <!-- 前景：线性渐变 (透明 -> 当前色) -->
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" HorizontalAlignment="Center">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,1" EndPoint="0,0" x:Name="AlphaGradientBrush">
                                <GradientStop Color="Transparent" Offset="0"/>
                                <GradientStop Color="Red" Offset="1" x:Name="AlphaGradientStop"/>
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                    </Rectangle>

                    <!-- Alpha 滑块游标 -->
                    <Canvas x:Name="AlphaCursorCanvas" Width="28" HorizontalAlignment="Center"  VerticalAlignment="Stretch">
                        <Grid x:Name="AlphaCursor" Width="28" Height="28" Margin="0,-14,0,0" MouseLeftButtonDown="Alpha_Thumb_MouseDown">
                            <Ellipse Width="28" Height="28"  Fill="White" Stroke="#F0F0F0" StrokeThickness="4">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="6" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <TextBlock Text="A" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10" FontWeight="Bold" Foreground="#AAA"/>
                        </Grid>
                    </Canvas>
                </Grid>
                <!-- Inputs & Preview -->
               <StackPanel Grid.Column="3" Margin="20,0,0,0"  >
                    <!-- 1. 预览区域 (保持不变) -->
                    <Grid Height="60" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.ColumnSpan="2" Background="White" CornerRadius="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="5" ShadowDepth="1" Opacity="0.1"/>
                            </Border.Effect>
                        </Border>
                        <Border Grid.ColumnSpan="2" Background="{StaticResource CheckerboardBrush}" CornerRadius="4" BorderBrush="#DDD" BorderThickness="1"/>
                        <Rectangle x:Name="OriginalColorRect" Fill="Gray" RadiusX="4" RadiusY="4" Margin="0,0,0,0">
                            <Rectangle.Clip>
                                <RectangleGeometry Rect="0,0,100,60"/>
                                <!-- 简单裁剪左半边，或者用 Grid Column 限制 -->
                            </Rectangle.Clip>
                        </Rectangle>
                        <!-- 修正：让 Rectangle 占满格子，利用 Grid.Column -->
                        <Border Grid.Column="0" Background="{Binding Fill, ElementName=OriginalColorRect}" CornerRadius="4,0,0,4"/>

                        <!-- 右边：新颜色 -->
                        <Border Grid.Column="1" Background="{Binding Fill, ElementName=NewColorRect}" CornerRadius="0,4,4,0"/>
                        <Rectangle x:Name="NewColorRect" Fill="Red" Visibility="Hidden"/>
                        <!-- 隐藏源，仅用于绑定 -->

                        <TextBlock Text="预览" Foreground="#88000000" VerticalAlignment="Center" HorizontalAlignment="Center" Grid.ColumnSpan="2" IsHitTestVisible="False" FontSize="12" FontWeight="Bold"/>
                    </Grid>


                    <!-- 2. 模式切换下拉框 (新增) -->
                    <ComboBox Style="{StaticResource FluentComboBoxStyle}"  x:Name="ColorModeCombo" Margin="0,0,0,10" SelectionChanged="ColorModeCombo_SelectionChanged" SelectedIndex="0" Padding="6,4">
                        <ComboBoxItem Content="RGB"/>
                        <ComboBoxItem Content="HSV"/>
                    </ComboBox>

                    <!-- 3. Hex 输入 (保持不变，无论模式如何都显示) -->
                    <Grid Margin="0,0,0,10" >
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="HexInput" Style="{StaticResource FluentTextBox}" Text="#FFFF0000" TextChanged="HexInput_TextChanged"/>
                        <TextBlock Text="HEX (8位)" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="{StaticResource TextSecondary}" FontSize="10"/>
                    </Grid>


                    <Separator Background="#EEE" Margin="0,0,0,10"/>

                    <!-- 4. 数值输入区域 (共用这3个输入框，通过C#代码改变Label文字和逻辑) -->
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- 输入框1 -->
                        <TextBox x:Name="Input1" Style="{StaticResource FluentTextBox}" Text="255" TextChanged="NumericInput_TextChanged"/>
                        <!-- 标签1 -->
                        <TextBlock x:Name="Label1" Text="红 (R)" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{StaticResource TextSecondary}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- 输入框2 -->
                        <TextBox x:Name="Input2" Style="{StaticResource FluentTextBox}" Text="0" TextChanged="NumericInput_TextChanged"/>
                        <!-- 标签2 -->
                        <TextBlock x:Name="Label2" Text="绿 (G)" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{StaticResource TextSecondary}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- 输入框3 -->
                        <TextBox x:Name="Input3" Style="{StaticResource FluentTextBox}" Text="0" TextChanged="NumericInput_TextChanged"/>
                        <!-- 标签3 -->
                        <TextBlock x:Name="Label3" Text="蓝 (B)" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{StaticResource TextSecondary}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <!-- 输入框 Alpha -->
                        <TextBox x:Name="InputAlpha" Style="{StaticResource FluentTextBox}" Text="255" TextChanged="NumericInput_TextChanged"/>
                        <TextBlock Text="Alpha" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{StaticResource TextSecondary}"/>
                    </Grid>
                </StackPanel>

            </Grid>

            <!-- 3. Color Swatches (扩展版) -->
            <Grid Grid.Row="2" Margin="24,15,24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Basic Colors -->
                <StackPanel>
                    <TextBlock Text="基本颜色" Foreground="{StaticResource TextSecondary}" FontSize="12" Margin="4,0,0,8"/>
                    <UniformGrid Columns="10" HorizontalAlignment="Left" VerticalAlignment="Top" x:Name="BasicColorsGrid">
                        <!-- Row 1: 浅色/粉彩色系 (Pastel & Light) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFFFF" Click="Swatch_Click" ToolTip="纯白"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFCCCC" Click="Swatch_Click" ToolTip="浅红"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFE5CC" Click="Swatch_Click" ToolTip="浅橙/皮肤"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFFCC" Click="Swatch_Click" ToolTip="浅黄"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCFFCC" Click="Swatch_Click" ToolTip="薄荷绿"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCFFFF" Click="Swatch_Click" ToolTip="浅青"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCE5FF" Click="Swatch_Click" ToolTip="淡蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#E5CCFF" Click="Swatch_Click" ToolTip="淡紫"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFCCFF" Click="Swatch_Click" ToolTip="淡粉"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#F5DEB3" Click="Swatch_Click" ToolTip="小麦色"/>

                        <!-- Row 2: 鲜艳/标准色系 (Vibrant & Primary) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#C0C0C0" Click="Swatch_Click" ToolTip="银色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF0000" Click="Swatch_Click" ToolTip="正红"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF8000" Click="Swatch_Click" ToolTip="橙色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFF00" Click="Swatch_Click" ToolTip="正黄"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#00FF00" Click="Swatch_Click" ToolTip="酸橙绿"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#00FFFF" Click="Swatch_Click" ToolTip="青色/天蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#0080FF" Click="Swatch_Click" ToolTip="蔚蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#8000FF" Click="Swatch_Click" ToolTip="紫罗兰"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF00FF" Click="Swatch_Click" ToolTip="品红"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#D2691E" Click="Swatch_Click" ToolTip="巧克力色"/>

                        <!-- Row 3: 中深/饱和色系 (Deep & Saturated) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#808080" Click="Swatch_Click" ToolTip="灰色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CC0000" Click="Swatch_Click" ToolTip="深红"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CC6600" Click="Swatch_Click" ToolTip="深橙"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFD700" Click="Swatch_Click" ToolTip="金色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#008000" Click="Swatch_Click" ToolTip="纯绿"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#008080" Click="Swatch_Click" ToolTip="水鸭青"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#0000FF" Click="Swatch_Click" ToolTip="纯蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#800080" Click="Swatch_Click" ToolTip="紫色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#C71585" Click="Swatch_Click" ToolTip="紫红"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#A0522D" Click="Swatch_Click" ToolTip="赭石"/>

                        <!-- Row 4: 极暗/阴影色系 (Dark & Shadow) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#000000" Click="Swatch_Click" ToolTip="纯黑"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#800000" Click="Swatch_Click" ToolTip="栗色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#663300" Click="Swatch_Click" ToolTip="深褐"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#808000" Click="Swatch_Click" ToolTip="橄榄色"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#004000" Click="Swatch_Click" ToolTip="深绿/森林"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#004040" Click="Swatch_Click" ToolTip="深岩青"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#000080" Click="Swatch_Click" ToolTip="海军蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#330066" Click="Swatch_Click" ToolTip="靛青"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#4B0082" Click="Swatch_Click" ToolTip="深紫蓝"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#3E2723" Click="Swatch_Click" ToolTip="咖啡色"/>
                    </UniformGrid>

                </StackPanel>

                <!-- Custom Colors -->
                <StackPanel Grid.Column="1" Margin="20,-10,40,0">
                    <StackPanel Orientation="Horizontal" Margin="4,0,0,8">
                        <TextBlock Text="自定义颜色" Foreground="{StaticResource TextSecondary}" FontSize="12" VerticalAlignment="Center"/>
                        <Button Content="+" Width="24" Height="24" Margin="10,0,0,0" Padding="0" 
                                Background="#E0E0E0" Foreground="#555" BorderThickness="0" 
                                ToolTip="添加当前颜色"
                                Click="AddCustomColor_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="12">
                                        <TextBlock Text="+" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-2,0,0" FontWeight="Bold"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#D0D0D0"/>
                                            <Setter Property="Foreground" Value="Black"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>

                    <UniformGrid Columns="6" x:Name="CustomColorsGrid">
                        <!-- 这是一个格子单元 -->
                        <Grid Width="24" Height="24" Margin="6">
                            <!-- 默认放一个虚线圆圈 -->
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>

                        <!-- 复制下面的 Grid 块，填满剩下的空位 (共18-24个左右) -->
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>


                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                    </UniformGrid>
                </StackPanel>
            </Grid>

            <!-- 4. Footer -->
            <Grid Grid.Row="3" Margin="24,20,24,24">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="确定" Width="100" Height="32" Style="{StaticResource FluentAccentButton}" Click="OkButton_Click" Margin="0,0,10,0"/>
                    <Button Content="取消" Width="100" Height="32" Style="{StaticResource FluentButton}" Click="CancelButton_Click"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>

<Window x:Class="TabPaint.ModernColorPickerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{DynamicResource L_ColorPicker_Title}" Height="660" Width="720"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" CornerRadius="8" GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
            
                <ResourceDictionary Source="pack://application:,,,/Resources/SubWindowStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <DrawingBrush x:Key="CheckerboardBrush" TileMode="Tile" Viewport="0,0,10,10" ViewportUnits="Absolute">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <GeometryDrawing Brush="{DynamicResource CheckerboardLightBrush}">
                            <GeometryDrawing.Geometry>
                                <RectangleGeometry Rect="0,0,10,10"/>
                            </GeometryDrawing.Geometry>
                        </GeometryDrawing>
                        <GeometryDrawing Brush="{DynamicResource CheckerboardDarkBrush}">
                            <GeometryDrawing.Geometry>
                                <GeometryGroup>
                                    <RectangleGeometry Rect="0,0,5,5"/>
                                    <RectangleGeometry Rect="5,5,5,5"/>
                                </GeometryGroup>
                            </GeometryDrawing.Geometry>
                        </GeometryDrawing>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>

            <!-- 迷你色块样式 -->
            <Style x:Key="MiniColorSwatch" TargetType="Button">
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Margin" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <Ellipse Width="24" Height="24" Fill="{StaticResource CheckerboardBrush}"/>
                                <Ellipse x:Name="ColorCircle" 
                     Fill="{TemplateBinding Background}" 
                     Stroke="{DynamicResource BorderBrush}" 
                     StrokeThickness="1"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ColorCircle" Property="Stroke" Value="{DynamicResource BorderDarkBrush}"/>
                                    <Setter TargetName="ColorCircle" Property="StrokeThickness" Value="2"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 文本框样式 -->
            <Style x:Key="FluentTextBox" TargetType="{x:Type TextBox}">
                <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource TextControlBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="Padding" Value="8,6"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type TextBox}">
                            <Border x:Name="border" Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="4">
                                <ScrollViewer x:Name="PART_ContentHost" Focusable="false" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="true">
                                    <Setter Property="BorderBrush" TargetName="border" Value="{DynamicResource BorderDarkBrush}"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="true">
                                    <Setter Property="BorderBrush" TargetName="border" Value="{DynamicResource SystemAccentBrush}"/>
                                    <Setter Property="BorderThickness" TargetName="border" Value="2"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 普通按钮样式 -->
            <Style x:Key="FluentButton" TargetType="{x:Type Button}">
                <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource TextControlBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Padding" Value="15,6"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border x:Name="border" Background="{TemplateBinding Background}" 
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="4">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" TargetName="border" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" TargetName="border" Value="{DynamicResource ButtonPressedBrush}"/>
                                    <Setter Property="RenderTransform">
                                        <Setter.Value>
                                            <ScaleTransform ScaleX="0.98" ScaleY="0.98" CenterX="50" CenterY="15"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 强调色按钮 -->
            <Style x:Key="FluentAccentButton" TargetType="{x:Type Button}" BasedOn="{StaticResource FluentButton}">
                <Setter Property="Background" Value="{DynamicResource SystemAccentBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource TextInverseBrush}"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" TargetName="border" Value="{DynamicResource SystemAccentHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" TargetName="border" Value="{DynamicResource SystemAccentPressedBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <ControlTemplate x:Key="FluentComboBoxToggleButton" TargetType="ToggleButton">
                <Border x:Name="Border" 
  CornerRadius="6" 
  BorderBrush="{TemplateBinding BorderBrush}" 
  BorderThickness="{TemplateBinding BorderThickness}" 
  Background="{TemplateBinding Background}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="24"/>
                        </Grid.ColumnDefinitions>
                        <!-- 下拉小箭头 -->
                        <Path x:Name="Arrow" Grid.Column="1" Fill="{DynamicResource TextSecondaryBrush}" 
        HorizontalAlignment="Center" VerticalAlignment="Center" 
        Data="M0,0 L3.5,3.5 L7,0" Stroke="{DynamicResource TextSecondaryBrush}" StrokeThickness="1"/>
                    </Grid>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter TargetName="Border" Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                        <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource BorderDarkBrush}"/>
                    </Trigger>
                    <Trigger Property="IsChecked" Value="true">
                        <Setter TargetName="Border" Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                        <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource SystemAccentBrush}"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!-- Fluent ComboBox Template -->
            <ControlTemplate x:Key="FluentComboBoxTemplate" TargetType="ComboBox">
                <Grid>
                    <ToggleButton Name="ToggleButton" 
            Template="{StaticResource FluentComboBoxToggleButton}" 
            Focusable="false" 
            BorderBrush="{TemplateBinding BorderBrush}"
            BorderThickness="{TemplateBinding BorderThickness}"
            Background="{TemplateBinding Background}"
            IsChecked="{Binding Path=IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}" 
            ClickMode="Press"/>

                    <ContentPresenter Name="ContentSite" IsHitTestVisible="False" 
                Content="{TemplateBinding SelectionBoxItem}"
                ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                Margin="10,0,24,0" VerticalAlignment="Center" HorizontalAlignment="Left" />

                    <TextBox x:Name="PART_EditableTextBox" 
       Style="{x:Null}" 
       BorderThickness="0" 
       Background="Transparent" 
       Foreground="{DynamicResource TextControlBrush}"
       Padding="0"
       Margin="10,0,24,0"
       VerticalAlignment="Center" 
       VerticalContentAlignment="Center"
       Focusable="True" 
       HorizontalAlignment="Stretch"
       CaretBrush="{DynamicResource TextPrimaryBrush}"/>

                    <!-- 下拉弹窗 -->
                    <Popup Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                        <Grid Name="DropDown" SnapsToDevicePixels="True" MinWidth="{TemplateBinding ActualWidth}" MaxHeight="{TemplateBinding MaxDropDownHeight}">
                            <Border x:Name="DropDownBorder" Background="{DynamicResource WindowBackgroundBrush}" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" CornerRadius="6" Margin="0,4,0,4">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="12" ShadowDepth="2" Opacity="0.1" Direction="270" Color="Black"/>
                                </Border.Effect>
                                <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </Popup>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsEditable" Value="false">
                        <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Collapsed"/>
                        <Setter TargetName="ContentSite" Property="Visibility" Value="Visible"/>
                    </Trigger>
                    <Trigger Property="IsEditable" Value="true">
                        <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="ContentSite" Property="Visibility" Value="Collapsed"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style x:Key="FluentComboBoxStyle" TargetType="ComboBox">
                <Setter Property="Height" Value="32"/>
                <Setter Property="Template" Value="{StaticResource FluentComboBoxTemplate}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
                <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource TextControlBrush}"/>
                <Setter Property="Margin" Value="0,0,8,0"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            </Style>

            <!-- 颜色块样式 -->
            <Style x:Key="ColorSwatch" TargetType="Button">
                <Setter Property="Width" Value="32"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="Margin" Value="2"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid>
                                <Ellipse x:Name="Border" Stroke="Transparent" StrokeThickness="2" Width="32" Height="32"/>
                                <Ellipse x:Name="ColorCircle" Width="24" Height="24" Fill="{TemplateBinding Background}" Stroke="{DynamicResource BorderLightBrush}" StrokeThickness="1"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Stroke" Value="{DynamicResource BorderMediumBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
        

    </Window.Resources>

    <!-- 主窗口背景 -->
    <Border Background="{DynamicResource WindowBackgroundBrush}" CornerRadius="8" BorderBrush="{DynamicResource BorderMediumBrush}" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.15" Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="64"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 1. Header -->
            <Border Grid.Row="0" Background="{DynamicResource PanelBackgroundBrush}" CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseDown" Margin="0,0,0,20">
                <Grid Margin="10,4,14,4">
                    <Image HorizontalAlignment="Left" x:Name="AppIcon" 
                           Grid.Column="0"
                           Source="pack://application:,,,/Resources/TabPaint.ico" 
                           Width="24" Height="24" 
                           Margin="4,0,12,0"
                           VerticalAlignment="Center"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                    <TextBlock Padding="36,0,0,0" Text="{DynamicResource L_ColorPicker_Title}" FontSize="16" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                    <Button HorizontalAlignment="Right" Content="✕" Width="32" Height="32"
                            Style="{StaticResource FluentButton}" Background="Transparent" BorderThickness="0" 
                            Foreground="{DynamicResource TextSecondaryBrush}"
                            Click="CancelButton_Click"/>
                </Grid>
            </Border>

            <!-- 2. Main Picker Area -->
            <Grid Grid.Row="1" Height="330" Margin="24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="280"/>
                    <ColumnDefinition Width="45"/>
                    <ColumnDefinition Width="30"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Color Map -->
                <Grid Grid.Column="0" ClipToBounds="False" Cursor="Cross"
                      MouseLeftButtonDown="Spectrum_MouseDown"
                      MouseMove="Spectrum_MouseMove"
                      MouseLeftButtonUp="Spectrum_MouseUp">
                    <Rectangle Fill="{StaticResource CheckerboardBrush}" RadiusX="4" RadiusY="4"/>
                    <Grid x:Name="SpectrumLayerGroup">
                        <Rectangle x:Name="SpectrumBaseColor" Fill="Red" RadiusX="4" RadiusY="4"/>
                        <Rectangle RadiusX="4" RadiusY="4">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="White" Offset="0"/>
                                    <GradientStop Color="#00FFFFFF" Offset="1"/>
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                        <Rectangle RadiusX="4" RadiusY="4">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                                    <GradientStop Color="Black" Offset="0"/>
                                    <GradientStop Color="#00000000" Offset="1"/>
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                    <Canvas x:Name="CursorCanvas" IsHitTestVisible="False">
                        <Ellipse x:Name="ColorCursor" Width="16" Height="16" Stroke="White" StrokeThickness="2" Margin="-8,-8,0,0">
                            <Ellipse.Effect>
                                <DropShadowEffect BlurRadius="4" ShadowDepth="0" Color="Black" Opacity="0.5"/>
                            </Ellipse.Effect>
                        </Ellipse>
                    </Canvas>
                </Grid>

                <!-- Hue Slider -->
                <Grid Grid.Column="1" Margin="0,0" Background="Transparent"
                      MouseLeftButtonDown="Hue_MouseDown"
                      MouseMove="Hue_MouseMove"
                      MouseLeftButtonUp="Hue_MouseUp"
                      Cursor="Hand" x:Name="HueSliderGrid">
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" 
                               HorizontalAlignment="Center" IsHitTestVisible="False">
                        <Rectangle.Fill>
                            <ImageBrush ImageSource="{Binding Source, ElementName=HueSliderImage}"/>
                        </Rectangle.Fill>
                    </Rectangle>
                    <Image x:Name="HueSliderImage" Visibility="Collapsed" Stretch="Fill" />
                    <Canvas x:Name="HueCursorCanvas" Width="28" HorizontalAlignment="Center" VerticalAlignment="Stretch">
                        <Grid x:Name="HueCursor" Width="28" Height="28" Margin="0,-14,0,0"  MouseLeftButtonDown="Hue_Thumb_MouseDown">
                            <Ellipse Width="28" Height="28" Fill="White" Stroke="{DynamicResource ChromeMediumBrush}" StrokeThickness="4">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="6" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                                </Ellipse.Effect>
                            </Ellipse>
                        </Grid>
                    </Canvas>
                </Grid>

                <!-- Alpha Slider -->
                <Grid Grid.Column="2" Margin="10,0,0,0" Background="Transparent"
                      MouseLeftButtonDown="Alpha_MouseDown"
                      MouseMove="Alpha_MouseMove"
                      MouseLeftButtonUp="Alpha_MouseUp"
                      Cursor="Hand" x:Name="AlphaSliderGrid">
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" 
                               HorizontalAlignment="Center" Fill="{StaticResource CheckerboardBrush}"/>
                    <Rectangle Width="20" RadiusX="10" RadiusY="10" HorizontalAlignment="Center">
                        <Rectangle.Fill>
                            <LinearGradientBrush StartPoint="0,1" EndPoint="0,0" x:Name="AlphaGradientBrush">
                                <GradientStop Color="Transparent" Offset="0"/>
                                <GradientStop Color="Red" Offset="1" x:Name="AlphaGradientStop"/>
                            </LinearGradientBrush>
                        </Rectangle.Fill>
                    </Rectangle>
                    <Canvas x:Name="AlphaCursorCanvas" Width="28" HorizontalAlignment="Center"  VerticalAlignment="Stretch">
                        <Grid x:Name="AlphaCursor" Width="28" Height="28" Margin="0,-14,0,0" MouseLeftButtonDown="Alpha_Thumb_MouseDown">
                            <Ellipse Width="28" Height="28" Fill="White" Stroke="{DynamicResource ChromeMediumBrush}" StrokeThickness="4">
                                <Ellipse.Effect>
                                    <DropShadowEffect BlurRadius="6" ShadowDepth="2" Opacity="0.3" Color="Black"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <TextBlock Text="A" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10" FontWeight="Bold" Foreground="#AAA"/>
                        </Grid>
                    </Canvas>
                </Grid>

                <!-- Inputs & Preview -->
                <StackPanel Grid.Column="3" Margin="20,0,0,0">
                    <!-- Preview Area -->
                    <Grid Height="60" Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.ColumnSpan="2" Background="{DynamicResource WindowBackgroundBrush}" CornerRadius="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="5" ShadowDepth="1" Opacity="0.1"/>
                            </Border.Effect>
                        </Border>
                        <Border Grid.ColumnSpan="2" Background="{StaticResource CheckerboardBrush}" CornerRadius="4" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1"/>
                        <Rectangle x:Name="OriginalColorRect" Fill="Gray" RadiusX="4" RadiusY="4" Visibility="Hidden"/>
                        <Border Grid.Column="0" Background="{Binding Fill, ElementName=OriginalColorRect}" CornerRadius="4,0,0,4"/>
                        <Border Grid.Column="1" Background="{Binding Fill, ElementName=NewColorRect}" CornerRadius="0,4,4,0"/>
                        <Rectangle x:Name="NewColorRect" Fill="Red" Visibility="Hidden"/>
                        <TextBlock Text="{DynamicResource L_ColorPicker_Preview}" Foreground="{DynamicResource TextTertiaryBrush}" VerticalAlignment="Center" HorizontalAlignment="Center" Grid.ColumnSpan="2" IsHitTestVisible="False" FontSize="12" FontWeight="Bold"/>
                    </Grid>

                    <ComboBox Style="{StaticResource FluentComboBoxStyle}" x:Name="ColorModeCombo" Margin="0,0,0,10" SelectionChanged="ColorModeCombo_SelectionChanged" SelectedIndex="0" Padding="6,4">
                        <ComboBoxItem Content="RGB"/>
                        <ComboBoxItem Content="HSV"/>
                    </ComboBox>

                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="HexInput" Style="{StaticResource FluentTextBox}" Text="#FFFF0000" TextChanged="HexInput_TextChanged"/>
                        <TextBlock Text="{DynamicResource L_ColorPicker_Hex}" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="10"/>
                    </Grid>

                    <Separator Background="{DynamicResource BorderLightBrush}" Margin="0,0,0,10"/>

                    <!-- Numeric Inputs -->
                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="Input1" Style="{StaticResource FluentTextBox}" Text="255" TextChanged="NumericInput_TextChanged"/>
                        <TextBlock x:Name="Label1" Text="{DynamicResource L_ColorPicker_Red}" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="Input2" Style="{StaticResource FluentTextBox}" Text="0" TextChanged="NumericInput_TextChanged"/>
                        <TextBlock x:Name="Label2" Text="{DynamicResource L_ColorPicker_Green}" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="Input3" Style="{StaticResource FluentTextBox}" Text="0" TextChanged="NumericInput_TextChanged"/>
                        <TextBlock x:Name="Label3" Text="{DynamicResource L_ColorPicker_Blue}" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Grid>

                    <Grid Margin="0,0,0,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="InputAlpha" Style="{StaticResource FluentTextBox}" Text="255" TextChanged="NumericInput_TextChanged"/>
                        <TextBlock Text="Alpha" Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- 3. Color Swatches -->
            <Grid Grid.Row="2" Margin="24,15,24,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Basic Colors -->
                <StackPanel>
                    <TextBlock Text="{DynamicResource L_ColorPicker_BasicColors}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" Margin="4,0,0,8"/>
                    <UniformGrid Columns="10" HorizontalAlignment="Left" VerticalAlignment="Top" x:Name="BasicColorsGrid">
                        <!-- Row 1: 浅色/粉彩色系 (Pastel & Light) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFFFF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_White}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFCCCC" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightRed}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFE5CC" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightOrange}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFFCC" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightYellow}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCFFCC" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_MintGreen}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCFFFF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightCyan}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CCE5FF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightBlue}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#E5CCFF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Lavender}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFCCFF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_LightPink}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#F5DEB3" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Wheat}"/>

                        <!-- Row 2: 鲜艳/标准色系 (Vibrant & Primary) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#C0C0C0" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Silver}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF0000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Red}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF8000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Orange}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFFF00" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Yellow}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#00FF00" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Lime}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#00FFFF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Cyan}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#0080FF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Azure}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#8000FF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Violet}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FF00FF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Magenta}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#D2691E" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Chocolate}"/>

                        <!-- Row 3: 中深/饱和色系 (Deep & Saturated) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#808080" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Gray}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CC0000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_DeepRed}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#CC6600" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_DeepOrange}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#FFD700" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Gold}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#008000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Green}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#008080" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Teal}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#0000FF" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Blue}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#800080" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Purple}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#C71585" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_DeepPink}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#A0522D" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Ochre}"/>

                        <!-- Row 4: 极暗/阴影色系 (Dark & Shadow) -->
                        <Button Style="{StaticResource ColorSwatch}" Background="#000000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Black}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#800000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Maroon}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#663300" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_DeepBrown}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#808000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Olive}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#004000" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_ForestGreen}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#004040" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_RockCyan}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#000080" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Navy}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#330066" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Indigo}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#4B0082" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_DeepViolet}"/>
                        <Button Style="{StaticResource ColorSwatch}" Background="#3E2723" Click="Swatch_Click" ToolTip="{DynamicResource L_Color_Coffee}"/>
                    </UniformGrid>
                </StackPanel>

                <!-- Custom Colors -->
                <StackPanel Grid.Column="1" Margin="20,-10,40,0">
                    <StackPanel Orientation="Horizontal" Margin="4,0,0,8">
                        <TextBlock Text="{DynamicResource L_ColorPicker_CustomColors}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                        <Button Content="+" Width="24" Height="24" Margin="10,0,0,0" Padding="0" 
                                Background="{DynamicResource ButtonBackgroundBrush}" 
                                Foreground="{DynamicResource TextSecondaryBrush}" 
                                BorderThickness="0" 
                                ToolTip="{DynamicResource L_ColorPicker_AddCurrentColor}"
                                Click="AddCustomColor_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="12">
                                        <TextBlock Text="+" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-2,0,0" FontWeight="Bold"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>

                    <UniformGrid Columns="6" x:Name="CustomColorsGrid">
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>


                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                        <Grid Width="24" Height="24" Margin="6">
                            <Ellipse Stroke="#BBB" StrokeThickness="1" StrokeDashArray="3 2"/>
                        </Grid>
                    </UniformGrid>
                </StackPanel>
            </Grid>

            <!-- 4. Footer -->
            <Grid Grid.Row="3" Margin="24,20,24,24">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="{DynamicResource L_Common_OK}" Width="100" Height="32" Style="{StaticResource FluentAccentButton}" Click="OkButton_Click" Margin="0,0,10,0"/>
                    <Button Content="{DynamicResource L_Common_Cancel}" Width="100" Height="32" Style="{StaticResource FluentButton}" Click="CancelButton_Click"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>
